generator client {
  provider = "prisma-client"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// ── Enums ──────────────────────────────────────────────

enum InteractionType {
  CALL_INBOUND
  CALL_OUTBOUND
  CALL_MISSED
  TEXT_INBOUND
  TEXT_OUTBOUND
  EMAIL_INBOUND
  EMAIL_OUTBOUND
  MEETING
  MAIL_SENT
  MAIL_RECEIVED
  NOTE
  OTHER
}

enum InteractionSource {
  MANUAL
  IMPORT_IOS
  IMPORT_ANDROID
  IMPORT_EMAIL
  API
}

enum NotableDateType {
  BIRTHDAY
  ANNIVERSARY
  FIRST_MET
  ELECTION
  CUSTOM
}

// ── Models ─────────────────────────────────────────────

model Contact {
  id              Int       @id @default(autoincrement())
  firstName       String    @map("first_name")
  lastName        String    @map("last_name")
  phone           String?
  email           String?
  photoUrl        String?   @map("photo_url")
  organization    String?
  title           String?
  location        String?
  linkedinUrl     String?   @map("linkedin_url")
  twitterUrl      String?   @map("twitter_url")
  website         String?
  notes           String?
  lastContactedAt DateTime? @map("last_contacted_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  interactions Interaction[]
  reminders    Reminder[]
  notableDates NotableDate[]
  tags         ContactTag[]
  groups       ContactGroup[]

  @@map("contacts")
}

model Tag {
  id            Int      @id @default(autoincrement())
  name          String   @unique
  color         String   @default("#6366f1")
  autoGenerated Boolean  @default(false) @map("auto_generated")
  createdAt     DateTime @default(now()) @map("created_at")

  contacts ContactTag[]

  @@map("tags")
}

model ContactTag {
  contactId  Int      @map("contact_id")
  tagId      Int      @map("tag_id")
  assignedAt DateTime @default(now()) @map("assigned_at")

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([contactId, tagId])
  @@map("contact_tags")
}

model Interaction {
  id              Int               @id @default(autoincrement())
  contactId       Int               @map("contact_id")
  type            InteractionType
  content         String?
  durationSeconds Int?              @map("duration_seconds")
  occurredAt      DateTime          @map("occurred_at")
  source          InteractionSource @default(MANUAL)
  createdAt       DateTime          @default(now()) @map("created_at")

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId, occurredAt])
  @@map("interactions")
}

model Reminder {
  id        Int      @id @default(autoincrement())
  contactId Int      @map("contact_id")
  remindAt  DateTime @map("remind_at")
  note      String?
  completed Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([remindAt, completed])
  @@map("reminders")
}

model Group {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")

  contacts ContactGroup[]

  @@map("groups")
}

model ContactGroup {
  contactId  Int      @map("contact_id")
  groupId    Int      @map("group_id")
  assignedAt DateTime @default(now()) @map("assigned_at")

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  group   Group   @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([contactId, groupId])
  @@map("contact_groups")
}

model NotableDate {
  id        Int             @id @default(autoincrement())
  contactId Int             @map("contact_id")
  type      NotableDateType
  label     String?
  month     Int
  day       Int
  year      Int?
  recurring Boolean         @default(true)
  notes     String?
  createdAt DateTime        @default(now()) @map("created_at")

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([month, day])
  @@map("notable_dates")
}

model Settings {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String

  @@map("settings")
}
